---
title: "Plotting and statistics"
author: "Martin Hanewald"
date: "1 August 2018"
output: 
    html_document:
        toc: true
        toc_float: true
        number_sections: true
        theme: lumen
        highlight: pygments
        df_print: paged
    
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Introduction

This document introduces basic steps in explanatory analysis using plotting techniques in the **ggplot2** package.

*(Tip insert a new code-chunk with CTRL+ALT+I)*

# Loading libraries
```{r}
library(tidyverse)
library(scales)
```

# Loading the data

We load the midwest dataset from the package ggplot2.

```{r}
data(midwest)
midwest <- midwest %>% mutate_at(vars(county, state, inmetro, category), as.factor)
head(midwest)

```
We have `r nrow(midwest)` datasets.

Basic structure of the variables:

```{r}
str(midwest)
```

You can always get a more in-depth description of the data with the comman `r ?midwest`.

# Basic plotting

Investigating the relationship between area and population.

```{r}
midwest %>% ggplot(aes(x=area, y=poptotal)) + geom_point(alpha=.5) + geom_smooth(method="lm") + scale_y_log10()
```

The linear trend only shows a slight positive correlation between area and population.


# Investigating the relationship between Education and Poverty

```{r}
midwest %>% ggplot(aes(x=percollege, y=percbelowpoverty)) + geom_point(aes(color=inmetro), alpha=.5) + geom_smooth(method="lm")
```

As expected there seems to be a negative correllation between college education and poverty.

# Are people living in a metropolitan area more educated?

```{r}
midwest %>% ggplot(aes(y = percollege, x = inmetro)) + geom_boxplot() + labs(x = 'Living in metropolitan area', y = 'Percentage of pop with college education', 
                                                                             title='Distribution of education vs living place')
```

What is the sample size?

```{r}
midwest %>% group_by(inmetro) %>% count()
```

Perform a two-sample t-test:

```{r}
t.test(percollege ~ inmetro, data= midwest, alternative = 'less')
```

The p-value is very small, meaning the null-hypothesis, that people are equally educated 
in metropolitan or rural areas can be confidently rejected. 

**Conclusion: There is very strong evidence, that people living in metropoliation areas are more educated.**


# Investigating the relationship between race and poverty

```{r}
midwest <- midwest %>% 
    mutate(lognonwhite = log(100-percwhite)) 

midwest %>% 
    ggplot(aes(x=lognonwhite, y=percbelowpoverty)) + 
    geom_point(alpha=.5) + 
    geom_smooth(method="lm")
```

## Zooming out to "state level"

Calculating the mean "lognonwhite percentage" per state:

```{r}
plotdat <- midwest %>% 
    group_by(state) %>% 
    summarise(lognonwhite = mean(lognonwhite),
              percbelowpoverty = mean(percbelowpoverty))
plotdat
```


```{r}
plotdat %>% ggplot(aes(x=lognonwhite, y=percbelowpoverty)) + 
    geom_point(alpha=.5) + 
    geom_smooth(method="lm") +
    coord_cartesian(ylim=c(0,15))
```

## Two-sample t-test

Let's fortify that thesis with a t-test on two groups.

```{r}
testdat <- midwest %>% 
    mutate(lognonwhite_cat = cut(lognonwhite,2)) 

testdat$lognonwhite_cat %>% table

testdat %>% ggplot(aes(y=percbelowpoverty, x=lognonwhite_cat)) + geom_boxplot()
```

The boxplot already gives evidence, that higher non-white population correlates with more poverty.

```{r}
t.test(percbelowpoverty ~ lognonwhite_cat, data=testdat)
```

And the t-test confirms this thesis.
